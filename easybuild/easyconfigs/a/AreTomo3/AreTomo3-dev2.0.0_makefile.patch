# Thomas Hoffmann, EBML Heidelberg, structures-it@embl.de, 2024/10
# allow to inject cuda compute capabilities and cfalgs
diff -ru AreTomo3-7ff7124891577f235f18756f13e335f35b464204/makefile11 AreTomo3-7ff7124891577f235f18756f13e335f35b464204_makefile/makefile11
--- AreTomo3-7ff7124891577f235f18756f13e335f35b464204/makefile11	2024-09-16 19:03:15.000000000 +0200
+++ AreTomo3-7ff7124891577f235f18756f13e335f35b464204_makefile/makefile11	2024-10-14 10:00:25.562403350 +0200
@@ -258,17 +258,23 @@
 	$(CUCPPS)
 OBJS = $(patsubst %.cpp, %.o, $(SRCS))
 #-------------------------------------
-CC = g++ -std=c++11
-CFLAG = -c -g -pthread -m64
+#CC = g++ -std=c++11
+CFLAG = -c -g -pthread -m64 $(CFLAGS)
 NVCC = $(CUDAHOME)/bin/nvcc -std=c++11
-CUFLAG = -Xptxas -dlcm=ca -O2 \
-	-gencode arch=compute_90,code=sm_90 \
-	-gencode arch=compute_89,code=sm_89 \
-	-gencode arch=compute_86,code=sm_86 \
-	-gencode arch=compute_80,code=sm_80 \
-	-gencode arch=compute_75,code=sm_75 \
-	-gencode arch=compute_70,code=sm_70 \
-        -gencode arch=compute_61,code=sm_61 
+SPACE= ' '
+SEMI= ;
+ENCODES = $(foreach x,$(subst $(SEMI),$(SPACE),$(CUDACC)),-gencode arch=compute_$x,code=sm_$x)
+CUFLAG = -Xptxas -dlcm=ca -O2 $(GENCODES)
+
+
+#CUFLAG = -Xptxas -dlcm=ca -O2 \
+#	-gencode arch=compute_90,code=sm_90 \
+#	-gencode arch=compute_89,code=sm_89 \
+#	-gencode arch=compute_86,code=sm_86 \
+#	-gencode arch=compute_80,code=sm_80 \
+#	-gencode arch=compute_75,code=sm_75 \
+#	-gencode arch=compute_70,code=sm_70 \
+#        -gencode arch=compute_61,code=sm_61 
 #------------------------------------------
 cuda: $(CUCPPS)
 
@@ -283,6 +289,7 @@
 	-lcufft -lcudart -lcuda -lnvToolsExt -ltiff -lc -lm -lpthread \
 	-o AreTomo3
 	@echo AreTomo3 has been generated.
+	@echo used cuda gencodes: $(GENCODES)
 
 %.cpp: %.cu
 	@echo "-----------------------------------------------"
