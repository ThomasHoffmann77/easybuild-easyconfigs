# Thomas Hoffmann, EMBL Heidelberg, structures-it@embl.de, 2024/05
easyblock = 'BinariesTarball'

name = 'AreTomo'
version = '1.3.4'
versionsuffix = '-CUDA-%(cudaver)s'
local_suffix = 'Feb222023'
local_fileID = '1q8OlMSWgJAilpUnjwvxsHGycJNGh0ar6'

homepage = 'https://msg.ucsf.edu/software'
description = """(Alignment and Reconstruction for Electron Tomography) is a GPU-accelerated     
software package that provides an integrated solution to both fiducial-free     
alignment and reconstruction for cryoEM tomography."""


toolchain = SYSTEM

source_urls = ['https://drive.google.com/uc?export=download&id=']
sources = [{
    'filename': '%%(name)s_%%(version)s_%s.zip' % local_suffix,
    'download_filename': local_fileID,
}]
patches = []
checksums = ['d331e4a1843fd8e457b6c58e3ab4255582673f024bfb0fae08cd54fc0c0c77e7']

postinstallcmds = [
    'mv %(installdir)s/bin/*.pdf %(installdir)s/',
    "cd %(installdir)s/bin && ln -s AreTomo_%(version)s_Cuda`echo %(cudaver)s|awk -F '.' '{print $1 $2}'`* AreTomo"
]

dependencies = [('CUDA', '11.8.0')]
sanity_check_commands = ['AreTomo --help']
sanity_check_paths = {
    'files': ['UCSFAreTomoLicensing.pdf', 'AreTomoManual_1.3.0_09292022.pdf', 'bin/AreTomo'],
    'dirs': ["bin"]
}

moduleclass = 'bio'
