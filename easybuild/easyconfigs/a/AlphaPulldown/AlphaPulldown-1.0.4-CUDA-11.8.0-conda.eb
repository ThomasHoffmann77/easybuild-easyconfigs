# Thomas Hoffmann, EMBL Heidelberg, structures-it@embl.de, 2024/05
easyblock = 'Conda'

name = "AlphaPulldown"
version = "1.0.4"
local_hwtype = 'gpu'
versionsuffix = '-CUDA-%(cudaver)s-conda'

homepage = 'https://www.embl-hamburg.de/AlphaPulldown/'
description = """AlphaPulldown, a Python package that streamlines protein-protein interaction    
screens and high-throughput modelling of higher-order oligomers using AlphaFold-
Multimer. It provides a convenient command line interface, a variety of         
confidence scores, and a graphical analysis tool."""

toolchain = SYSTEM

channels = ['omnia', 'bioconda', 'conda-forge']
local_reqs = [
    '_libgcc_mutex==0.1',
    '_openmp_mutex==4.5',
    'biopython==1.83',
    'brotli==1.1.0',
    'brotli-bin==1.1.0',
    'brotli-python==1.1.0',
    'cairo==1.18.0',
    'cctbx-base==2024.4',
    'chardet==5.2.0',
    'colorama==0.4.6',
    'contourpy==1.2.1',
    'cudatoolkit==11.8.0',
    'cycler==0.12.1',
    'exceptiongroup==1.2.0',
    'expat==2.6.2',
    'font-ttf-dejavu-sans-mono==2.37',
    'font-ttf-inconsolata==3.000',
    'font-ttf-source-code-pro==2.038',
    'font-ttf-ubuntu==0.83',
    'fontconfig==2.14.2',
    'fonts-conda-ecosystem==1',
    'fonts-conda-forge==1',
    'fonttools==4.52.4',
    'freetype-py==2.3.0',
    'future==1.0.0',
    'hhsuite==3.3.0',
    'hmmer==3.3.2',
    'importlib-metadata==7.1.0',
    'importlib_metadata==7.1.0',
    'iniconfig==2.0.0',
    'kalign2==2.04',
    'kiwisolver==1.4.5',
    'lcms2==2.16',
    'ld_impl_linux-64==2.40',
    'libblas==3.9.0',
    'libboost==1.84.0',
    'libboost-python==1.84.0',
    'libbrotlicommon==1.1.0',
    'libbrotlidec==1.1.0',
    'libbrotlienc==1.1.0',
    'libcblas==3.9.0',
    'libdeflate==1.20',
    'libgfortran-ng==13.2.0',
    'libglib==2.80.2',
    'libglu==9.0.0',
    'libjpeg-turbo==3.0.0',
    'liblapack==3.9.0',
    'libopenblas==0.3.27',
    'libsvm==3.16',
    'libtiff==4.6.0',
    'libxcb==1.15',
    'libzlib==1.2.13',
    'matplotlib-base==3.8.4',
    'mrcfile==1.5.0',
    'munkres==1.0.7',
    'numpy==1.26.4',
    'ocl-icd==2.3.2',
    'ocl-icd-system==1.0.0',
    'openjpeg==2.5.2',
    'openmm==8.0.0',
    'openssl==3.3.0',
    'packaging==24.0',
    'pcre2==10.43',
    'pdbfixer==1.9',
    'perl==5.32.1',
    'pillow==10.3.0',
    'pixman==0.43.2',
    'pluggy==1.5.0',
    'psutil==5.9.8',
    'pthread-stubs==0.4',
    'pycairo==1.26.0',
    'pyparsing==3.1.2',
    'pytest==8.2.1',
    'python==3.10.0',
    'python-dateutil==2.9.0',
    'python_abi==3.10',
    'reportlab==4.1.0',
    'requests==2.32.2',
    'rlpycairo==0.2.0',
    'scipy==1.13.1',
    'setuptools==70.0.0',
    'six==1.16.0',
    'sqlite==3.45.3',
    'tomli==2.0.1',
    'unicodedata2==15.1.0',
    'xorg-kbproto==1.0.7',
    'xorg-libice==1.1.1',
    'xorg-libsm==1.2.4',
    'xorg-libx11==1.8.9',
    'xorg-libxext==1.3.4',
    'xorg-libxrender==0.9.11',
    'xorg-renderproto==0.11.1',
    'xorg-xextproto==7.3.0',
    'xorg-xproto==7.0.31',
    'zipp==3.17.0',
    'zlib==1.2.13',
]
requirements = ' '.join(local_reqs)

builddependencies = [('Miniconda3', '22.11.1-1', '', SYSTEM)]
dependencies = [
    ('CUDA', '11.8.0', '', SYSTEM),
    ('cuDNN', '8.7.0.84', '-CUDA-%(cudaver)s', SYSTEM)
]
postinstallcmds = [
    '%(installdir)s/bin/pip install alphapulldown==%(version)s',
    '%(installdir)s/bin/pip install alphapulldown',
    '%(installdir)s/bin/pip install -q "jax[cuda]==0.4.23" jaxlib==0.4.23+cuda11.cudnn86 '
    '-f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html'
]

# sanity_check_commands=[('create_individual_features.py ','--helpshort')]
sanity_check_paths = {
    'files': [],
    'dirs': ['lib/python3.10/site-packages/alphapulldown']
}

moduleclass = 'bio'
